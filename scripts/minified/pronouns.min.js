// pronouns.min.js, for SugarCube 2, by Chapel
;!function(){"use strict";if(Template&&Template.add&&"function"==typeof Template.add){var d={name:"gender",showSetting:!0,label:"Gender",desc:"",storyVar:"%%gender",default:"female"},e="#setting-control-"+d.name,p={subjective:["she","he","they"],objective:["her","him","them"],possessive:["hers","his","theirs"],determiner:["her","his","their"],reflexive:["herself","himself","themself"],noun:["woman","man","person"]};d.showSetting&&(Setting.addToggle(d.name,{label:d.label,desc:d.desc&&"string"==typeof d.desc&&d.desc.trim()?d.desc.trim():void 0}),$(document).on(":dialogopen :dialogopened",function(){$("#ui-dialog-body").hasClass("settings")&&$(e).parent("div").empty().append($(document.createElement("button")).append("Configure...").ariaClick(function(){h()}))}));var t=/^is$/i,a=/^was$/i,r=/^has$/i,n=/oes$/i,s=/^[dl]ies$/i,i=/ies$/i,o=/sses$/i,l=/hes$/i,u=/s$/i,c=/they/i;Template.add(["he","she","they","He","She","They"],function(){return S(this.name,g().subjective)}),Template.add(["him","her","them","Him","Her","Them"],function(){return S(this.name,g().objective)}),Template.add(["his","hers","theirs","His","Hers","Theirs"],function(){return S(this.name,g().possessive)}),Template.add(["his_","her_","their","His_","Her_","Their"],function(){return S(this.name,g().determiner)}),Template.add(["himself","herself","themself","Himself","Herself","Themself"],function(){return S(this.name,g().reflexive)}),Template.add(["man","woman","person","Man","Woman","Person"],function(){return S(this.name,g().noun)}),Template.add(["he-s","she-s","they-re","He-s","She-s","They-re"],function(){return S(this.name,g().subjective+T("&apos;s","&apos;re",y()))}),Macro.add("pronouns",{skipArgs:!0,handler:function(){h()}}),Macro.add("verb",{handler:function(){var e=y();if(this.args.length<1)return this.error("Please pass at least a singular third person pronoun to this macro.");this.args.includes("plural")&&(e=!0),this.output.append(T(String(this.args[0]),this.args[1]?String(this.args[1]):null,!!e))}}),setup.gender={pronouns:g,setPronouns:function(e){return"string"==typeof e?v(e):"object"==typeof e?function(e){if("object"==typeof e)return State.variables[d.storyVar]=v("male"===d.default?1:0),Object.assign(State.variables[d.storyVar],e)}(e):void 0},dialog:h,pluralize:b},window.gender=window.gender||setup.gender}else alert("Warning, this version of SugarCube does not include the Template API. Please upgrade to v2.29.0 or higher.");function m(){var e=$(document.createElement("div"));var t,a,r,n,s=Object.keys(p).map(function(e){var t=2;"male"===d.default?t=1:"female"===d.default&&(t=0);var a,r,n,s=State.variables,i=p[e][t];return s[d.storyVar]&&s[d.storyVar][e]&&(i=s[d.storyVar][e]),a=e.toUpperFirst()+": ",r="gender-"+e,n=i,$(document.createElement("label")).append(a).css("display","block").append($(document.createElement("input")).attr({type:"text",name:r}).css({float:"right","margin-left":"0.2em"}).val(n))}),i=(t="Presets: ",a="gender-preset",r=["She/Her","He/Him","They/Them"],n=$(document.createElement("select")).attr("name",a).css("float","right"),r.forEach(function(e,t){console.log(t),$(document.createElement("option")).attr("value",String(t)).append(e).appendTo(n)}),$(document.createElement("label")).css("display","block").append(t,n)).on("change",function(){var r=Number($(this).find("select").val());Number.isNaN(r)||s.forEach(function(e){var t=e.find("input"),a=t.attr("name").split("-")[1];t.val(p[a][r])})}),o=i.find("select");State.variables[d.storyVar]?o.val(""):"male"===d.default?o.val("1"):"female"===d.default?o.val("0"):o.val("2");var l,u=$(document.createElement("button")).wiki("Confirm").addClass("gender-confirm").ariaClick({label:"Confirm pronoun selection."},function(){var r=State.variables;r[d.storyVar]={},s.forEach(function(e){var t=e.find("input"),a=t.attr("name").split("-")[1];r[d.storyVar][a]=t.val().trim().toLowerCase()}),$("#ui-dialog-body").hasClass("reopen")&&UI.settings(),Dialog.close()}),c=(l=[i,"<br>"],s.forEach(function(e){l.push(e),l.push("<br>")}),l.push(u),l);return e.append(c)}function h(){var e,t,a,r;e="Customize Gender",t=m(),r=!(a="custom-gender"),Dialog.isOpen()&&$("#ui-dialog-body").hasClass("settings")&&(r=!0),Dialog.close(),Dialog.setup(e,r?a+" reopen":a),Dialog.append(t),Dialog.open()}function f(t){("number"!=typeof t||Number.isNaN(t)||2<t||t<0)&&(t=0);var a={};return Object.keys(p).forEach(function(e){a[e]=p[e][t]}),a}function g(){return State.variables[d.storyVar]&&State.variables[d.storyVar].subjective?State.variables[d.storyVar]:f("male"===d.default?1:0)}function v(e){var t;switch(e){case"female":t=f(0);break;case"male":t=f(1);break;default:t=f(2)}return State.variables[d.storyVar]=clone(t),t}function b(e){return e&&"string"==typeof e?(e=e.trim(),t.test(e)?e.replace(t,"are"):a.test(e)?e.replace(a,"were"):r.test(e)?e.replace(r,"have"):n.test(e)?e.replace(n,"o"):s.test(e)?e.replace(i,"ie"):i.test(e)?e.replace(i,"y"):o.test(e)?e.replace(o,"ss"):l.test(e)?e.replace(l,"h"):u.test(e)?e.replace(u,""):e):e}function y(){return c.test(g().subjective.trim())}function T(e,t,a){return a?t&&"string"==typeof t?t:b(e):e}function S(e,t){return e.first()===e.first().toUpperCase()?t.toUpperFirst():t}}();
// end pronouns.min.js