// pronouns.min.js, for SugarCube 2, by Chapel
;!function(){"use strict";if(Template&&Template.add&&"function"==typeof Template.add){var c={name:"gender",showSetting:!0,label:"Gender",desc:"",storyVar:"%%gender",default:"female"},e="#setting-control-"+c.name,p={subjective:["she","he","they"],objective:["her","him","them"],possessive:["hers","his","theirs"],determiner:["her","his","their"],reflexive:["herself","himself","themself"],noun:["woman","man","person"]};c.showSetting&&(Setting.addToggle(c.name,{label:c.label,desc:c.desc&&"string"==typeof c.desc&&c.desc.trim()?c.desc.trim():void 0}),$(document).on(":dialogopen :dialogopened",function(){$("#ui-dialog-body").hasClass("settings")&&$(e).parent("div").empty().append($(document.createElement("button")).append("Configure...").ariaClick(function(){m()}))})),Template.add(["he","she","they","He","She","They"],function(){return f(this.name,h().subjective)}),Template.add(["him","her","them","Him","Her","Them"],function(){return f(this.name,h().objective)}),Template.add(["his","hers","theirs","His","Hers","Theirs"],function(){return f(this.name,h().possessive)}),Template.add(["his_","her_","their","His_","Her_","Their"],function(){return f(this.name,h().determiner)}),Template.add(["himself","herself","themself","Himself","Herself","Themself"],function(){return f(this.name,h().reflexive)}),Template.add(["man","woman","person","Man","Woman","Person"],function(){return f(this.name,h().noun)});var t=/^is$/i,r=/^was$/i,a=/oes$/i,n=/^[dl]ies$/i,s=/ies$/i,i=/sses$/i,o=/hes$/i,l=/s$/i,u=/they/i;Macro.add("pronouns",{skipArgs:!0,handler:function(){m()}}),Macro.add("verb",{handler:function(){var e=u.test(h().subjective.trim());if(this.args.length<1)return this.error("Please pass at least a singular third person pronoun to this macro.");this.args.includes("plural")&&(e=!0),this.output.append(function(e,t,r){return r?t&&"string"==typeof t?t:g(e):e}(String(this.args[0]),this.args[1]?String(this.args[1]):null,!!e))}}),setup.gender={pronouns:h,dialog:m,pluralize:g},window.gender=window.gender||setup.gender}else alert("Warning, this version of SugarCube does not include the Template API. Please upgrade to v2.29.0 or higher.");function d(){var e=$(document.createElement("div"));var t,r,a,n,s=Object.keys(p).map(function(e){var t=2;"male"===c.default?t=1:"female"===c.default&&(t=0);var r=State.variables,a=p[e][t];return r[c.storyVar]&&r[c.storyVar][e]&&(a=r[c.storyVar][e]),function(e,t,r){return $(document.createElement("label")).append(e).css("display","block").append($(document.createElement("input")).attr({type:"text",name:t}).css({float:"right","margin-left":"0.2em"}).val(r))}(e.toUpperFirst()+": ","gender-"+e,a)}),i=(t="Presets: ",r="gender-preset",a=["She/Her","He/Him","They/Them"],n=$(document.createElement("select")).attr("name",r).css("float","right"),a.forEach(function(e,t){console.log(t),$(document.createElement("option")).attr("value",String(t)).append(e).appendTo(n)}),$(document.createElement("label")).css("display","block").append(t,n)).on("change",function(){var a=Number($(this).find("select").val());Number.isNaN(a)||s.forEach(function(e){var t=e.find("input"),r=t.attr("name").split("-")[1];t.val(p[r][a])})}),o=i.find("select");State.variables[c.storyVar]?o.val(""):"male"===c.default?o.val("1"):"female"===c.default?o.val("0"):o.val("2");var l,u=$(document.createElement("button")).wiki("Confirm").addClass("gender-confirm").ariaClick({label:"Confirm pronoun selection."},function(){var a=State.variables;a[c.storyVar]={},s.forEach(function(e){var t=e.find("input"),r=t.attr("name").split("-")[1];a[c.storyVar][r]=t.val().trim().toLowerCase()}),$("#ui-dialog-body").hasClass("reopen")&&UI.settings(),Dialog.close()}),d=(l=[i,"<br>"],s.forEach(function(e){l.push(e),l.push("<br>")}),l.push(u),l);return e.append(d)}function m(){!function(e,t,r){var a=!1;Dialog.isOpen()&&$("#ui-dialog-body").hasClass("settings")&&(a=!0),Dialog.close(),Dialog.setup(e,a?r+" reopen":r),Dialog.append(t),Dialog.open()}("Customize Gender",d(),"custom-gender")}function h(){if(State.variables[c.storyVar]&&State.variables[c.storyVar].subjective)return State.variables[c.storyVar];var t=2;"male"===c.default?t=1:"female"===c.default&&(t=0);var r={};return Object.keys(p).forEach(function(e){r[e]=p[e][t]}),r}function f(e,t){return e.first()===e.first().toUpperCase()?t.toUpperFirst():t}function g(e){return e&&"string"==typeof e?(e=e.trim(),t.test(e)?e.replace(t,"are"):r.test(e)?e.replace(r,"were"):a.test(e)?e.replace(a,"o"):n.test(e)?e.replace(s,"ie"):s.test(e)?e.replace(s,"y"):i.test(e)?e.replace(i,"ss"):o.test(e)?e.replace(o,"h"):l.test(e)?e.replace(l,""):e):e}}();
// end pronouns.min.js